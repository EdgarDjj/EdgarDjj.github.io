# HttpHttps

# HTTP/HTTPS

![五层体系结构.png](HttpHttps/TELNET.png)

## HTTP是什么？

HTTP（Hyper Text Transfer Protocol），是Web服务器传输超文本标记语言（HTML）到本地浏览器的传送协议。HTTP的诞生主要是为了能够让文档之间相互关联，形成超文本可以相互传阅。

## HTTP基本概念

为什么要在计算机中分层次？

因为两台计算机能够相互通信的话，实际实现起来是非常困难操作的，我们**分层的目的就是为了将困难的问题简单化**，并且如果我们分层了，我们在使用的时候就可以**仅仅关注我们需要关注的层次，而不用理会其它层**。

如果我们需要改动设计的时候，我们需要变动的层替换即可，并不用涉及到其它的层次。这是我们程序设计中的低耦合是一个概念。

**而我们的HTTP协议是最上层，也就是应用。**这就最贴近我们程序员的层次。

### HTTP原理

HTTP是基于[TCP/IP](TCP/IP)通信协议来传递数据的协议，客户端发起TCP请求，三次握手建立连接后，客户端发起HTTP请求，服务端进行HTTP响应。

1. 用户请求 -> 浏览器
2. 浏览器 -> 发起TCP连接请求 -> 服务器(Tomcat)
3. 服务器接收请求并建立连接
4. 生成HTTP数据包(浏览器) 
5. 浏览器 发送数据包 -> 服务器
6. 解析HTTP格式的数据包(服务器)
7. 执行请求
8. 生成HTTP格式的数据包
9. 服务器 发送响应数据包 -> 浏览器
10. 浏览器 解析HTTP格式数据包
11. 浏览器程序html响应给用户

### HTTP特点

1. http协议支持客户端/服务端模式，也是一种请求/响应模式的协议。
2. 简单快速：客户向服务器请求服务时，只需传送请求方法和路径。请求方法常用的有GET、HEAD、POST。
3. 灵活：HTTP允许传输任意类型的数据对象。传输的类型由Content-Type加以标记。
4. 无连接：限制每次连接只处理一个请求。服务器处理完请求，并收到客户的应答后，即断开连接，但是却不利于客户端与服务器保持会话连接，为了弥补这种不足，产生了两项记录http状态的技术，一个叫做Cookie,一个叫做Session。
5. 无状态：无状态是指协议对于事务处理没有记忆，后续处理需要前面的信息，则必须重传。

### 常见请求方法

-  GET： ⽤于请求访问已经被URI（统⼀资源标识符）识别的资源，可以通过URL传参给服务器
-   POST：⽤于传输信息给服务器，主要功能与GET⽅法类似，但⼀般推荐使⽤POST⽅式。
-   PUT： 传输⽂件，报⽂主体中包含⽂件内容，保存到对应URI位置。
-   HEAD： 获得报⽂⾸部，与GET⽅法类似，只是不返回报⽂主体，⼀般⽤于验证URI是否有效。
-   DELETE：删除⽂件，与PUT⽅法相反，删除对应URI位置的⽂件。 
-  OPTIONS：查询相应URI⽀持的HTTP⽅法。

### 响应状态码

**状态码分类**：

- 1XX- 信息型，服务器收到请求，需要请求者继续操作。
- 2XX- 成功型，请求成功收到，理解并处理。
- 3XX - 重定向，需要进一步的操作以完成请求。
- 4XX - 客户端错误，请求包含语法错误或无法完成请求。
- 5XX - 服务器错误，服务器在处理请求的过程中发生了错误。

**常见状态码**：

- 200 OK - 客户端请求成功
- 204 成功处理，但服务器没有新数据返回，显示页面不更新
- 206 对服务器进行范围请求，服务器只返回部分资源
- 301 - 资源（网页等）被永久转移到其它URL
- 302 - 临时跳转
- 303 和 302 相同的功能，但明确刻画单应该采用GET方式来获取资源
- 304 发送了附带请求，但不符合条件（返回未过期的缓存数据）
- 400 Bad Request - 客户端请求有语法错误，不能被服务器所理解（请求报文语法有错误）
- 401 Unauthorized - 请求未经授权，这个状态代码必须和WWW-Authenticate报头域一起使用（需要认证身份）
- 403 - 没有权限访问（没有权限）
- 404 - 请求资源不存在，可能是输入了错误的URL（服务器没有该资源）
- 500 - 服务器内部发生了不可预期的错误（内部资源出错）
- 503 Server Unavailable - 服务器当前不能处理客户端的请求，一段时间后可能恢复正常。（服务器繁忙）

## 服务器与客户端之间的应用程序

一个HTTP服务器可以拥有多个站点，HTTP下可以配置多个节点的主机，当客户端访问的时候，可能访问的资源处于不同的主机，但实际上访问的是同一台HTTP服务器。

**客户端和服务端之间还有一些用于通信数据转发的应用程序**

* 代理
  * 可以用来缓存，当代理缓存后，客户端就可直接从代理获取数据
  * 可以用来对网站进行访问控制，获取访问日志记录
* 网关
  * 能够提供非HTTP请求操作，访问数据库之类
* 隧道
  * 建立一条安全的通信路径，可以使用SSL等加密手段加密

## HTTP首部简述

### HTTP报文组成

请求报文：

- 请求行：请求方法、URL（Uniform Resource Location）、协议/版本
- 请求头（Request Header）
- 请求正文

响应报文：

- 状态行
- 响应头
- 响应正文

### 请求报文

⾸部字段例⼦：

* Accept: text/html,image/* 【浏览器告诉服务器，它⽀持的数据类型】 
* Accept-Charset: ISO-8859-1 【浏览器告诉服务器，它⽀持哪种字符集】 
* Accept-Encoding: gzip,compress 【浏览器告诉服务器，它⽀持的压缩格式】 
* Accept-Language: en-us,zh-cn 【浏览器告诉服务器，它的语⾔环境】 
* Host: www.it315.org:80【浏览器告诉服务器，它的想访问哪台主机】 
* If-Modiﬁed-Since: Tue, 11 Jul 2000 18:23:51 GMT【浏览器告诉服务器，缓存数据的时间】 
* Referer: http://www.it315.org/index.jsp【浏览器告诉服务器，客户机是从那个⻚⾯来的---反盗 链】 
* 8.User-Agent: Mozilla/4.0 (compatible; MSIE 5.5; Windows NT 5.0)【浏览器告诉服务器，浏览 器的内核是什么】 
* Cookie【浏览器告诉服务器，带来的Cookie是什么】
*  Connection: close/Keep-Alive 【浏览器告诉服务器，请求完后是断开链接还是保持链接】 
* Date: Tue, 11 Jul 2000 18:23:51 GMT【浏览器告诉服务器，请求的时间】

## HTTPS

### HTTPS出现的原因

http传输的信息，是明文传输，不安全，容易被窃听截取。

* 通信使用明文
* 不验证通信方身份，无论是客户端和服务器，都是随意通信的
* 无法验证报文的完整性（别人监听后，可以篡改）

**一般http中存在如下问题：**

- 请求信息明文传输，容易被窃听截取。
- 数据的完整性未校验，容易被篡改
- 没有验证对方身份，存在冒充危险

### 什么是HTTPS？

HTTPS协议（HyperText Transfer Protocol over Secure Socket Layer）：一般为HTTP+SSL/TLS，通过SSL证书来验证服务器身份，并为浏览器和服务器之间的通信进行加密。

#### 加密

* 对称加密
  * 加密和解密都是用同一个密钥
* 非对称加密RSA
  * 加密用公开的密钥，解密用私钥
  * 私钥只有自己知道，公开的密钥大家都知道
* 数字签名
  * 验证传输的内容是对方发送的数据
  * 发送的数据没有被篡改过
* 数据证书（Certificate Authority）简称CA
  * 认证机构证明是**真实服务器发送的数据**

### **HTTPS**的缺点

- HTTPS协议多次握手，导致页面的加载时间延长近50%；
- HTTPS连接缓存不如HTTP高效，会增加数据开销和功耗；
- 申请SSL证书需要钱，功能越强大的证书费用越高。
- SSL涉及到的安全算法会消耗 CPU 资源，对服务器资源消耗较大。

### HTTPS工作原理

一、首先HTTP请求服务端生成证书，客户端对证书的有效性、合法性、域名是否与请求的域名一致、证书的公钥（RSA加密）等进行校验。

二、客户端如果校验通过后，就根据证书的公钥的有效，生成随机数，随机数使用公钥进行加密（RSA加密）

三、消息体产生的后，对它的摘要进行MD5算法加密，此时就得到了RSA签名

四、发送给服务端，此时只有服务端（RSA私钥）能解密

五、解密得到的随机数，再要AES加密，作为密钥（此时的密钥只有客户端和服务端知道）

## HTTP常见面试题

### Https 与 Http 的区别：

1. HTTP的标准端口是80，而HTTPS的标准端口是443
2. 在OSI网络模型中，HTTP工作处于应用层，而HTTPS的安全传输机制工作在传输层
3. HTT无需证书，而HTTPS需要CA机制颁发的SSL证书

### 一次完整的HTTP请求步骤

> 一次完整的HTTP请求所经历的7个步骤

1. 建立TCP连接
   在HTTP工作开始之前，Web浏览器首先要通过网络与Web服务器建立连接，该连接是通过TCP来完成的，该协议与IP协议共同构建Internet，即著名的TCP/IP协议族，因此Internet又被称作是TCP/IP网络。HTTP是比TCP更高层次的应用层协议，根据规则，只有低层协议建立之后才能进行更高层协议的连接，因此，首先要建立TCP连接，一般TCP连接的端口号是80。

2. Web浏览器向Web服务器发送请求命令 
   一旦建立了TCP连接，Web浏览器就会向Web服务器发送请求命令。例如：GET/sample/hello.jsp HTTP/1.1。

3. Web浏览器发送请求头信息 
   浏览器发送其请求命令之后，还要以头信息的形式向Web服务器发送一些别的信息，之后浏览器发送了一空白行来通知服务器，它已经结束了该头信息的发送。

4. Web服务器应答 
   客户机向服务器发出请求后，服务器会客户机回送应答， HTTP/1.1 200 OK ，应答的第一部分是协议的版本号和应答状态码。

5. Web服务器发送应答头信息 
   正如客户端会随同请求发送关于自身的信息一样，服务器也会随同应答向用户发送关于它自己的数据及被请求的文档。

6. Web服务器向浏览器发送数据 
   Web服务器向浏览器发送头信息后，它会发送一个空白行来表示头信息的发送到此为结束，接着，它就以Content-Type应答头信息所描述的格式发送用户所请求的实际数据。\
7. Web服务器关闭TCP连接 
   一般情况下，一旦Web服务器向浏览器发送了请求数据，它就要关闭TCP连接，然后如果浏览器或者服务器在其头信息加入了这行代码：Connection:keep-alive

### 参考链接

https://zhuanlan.zhihu.com/p/72616216

https://snailclimb.gitee.io/javaguide/#/

https://blog.csdn.net/freekiteyu/article/details/72236734




